{"version":3,"sources":["System.js","MemoryCard.js","MemoryCard.Connector.js","MemoryCard.Connector.Object.js","GameSave.js","Game.js","Game.Remote.js","Game.Embedded.js","Stick.js","Controller.js","Controller.Keyboard.js","Component.js","components/List.js","Button.js","Axis.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"MorgasGS-0.8.3.js","sourcesContent":["(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet gs=µ.gs=µ.gs||{};\r\n\r\n\tSC=SC({\r\n\t\trs:\"rescope\"\r\n\t});\r\n\r\n\tgs.System=µ.Class({\r\n\t\tconstructor:function()\r\n\t\t{\r\n\t\t\tSC.rs.all(this,[\"pauseListener\",\"keyListener\"]);\r\n\r\n\t\t\tthis.controllers=new Set();\r\n\t\t\tthis.pause=true;\r\n\t\t\tthis.game=null;\r\n\t\t\tthis.memoryCard=null;\r\n\r\n\t\t\tthis.domElement=document.createElement(\"DIV\");\r\n\t\t\tthis.domElement.classList.add(\"System\");\r\n\t\t\tthis.domElement.tabIndex=-1;\r\n\r\n\t\t\tthis.domElement.addEventListener(\"focus\",this.pauseListener,false);\r\n\t\t\tthis.domElement.addEventListener(\"blur\",this.pauseListener,false);\r\n\r\n\t\t\tthis.domElement.addEventListener(\"keydown\",this.keyListener,false);\r\n\t\t\tthis.domElement.addEventListener(\"keyup\",this.keyListener,false);\r\n\t\t},\r\n\t\tOLD_SAVE_COUNT:3, //0 => keep all saves; should NEVER be negative\r\n\t\tpauseListener(event)\r\n\t\t{\r\n\t\t\tthis.pause=(event.type===\"blur\");\r\n\t\t\tthis.domElement.classList.toggle(\"pause\",this.pause);\r\n\t\t\tif(this.game!=null)\r\n\t\t\t{\r\n\t\t\t\tthis.game.setPause(this.pause);\r\n\t\t\t}\r\n\t\t},\r\n\t\tkeyListener(event)\r\n\t\t{\r\n\t\t\tif(HMOD(\"gs.Controller.Keyboard\"))\r\n\t\t\t{\r\n\t\t\t\tlet KeyCon=GMOD(\"gs.Controller.Keyboard\");\r\n\t\t\t\tlet eventConsumed=false;\r\n\t\t\t\tfor(let con of this.controllers)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(con instanceof KeyCon)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\teventConsumed|=con.parseEvent(event);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif(eventConsumed)\r\n\t\t\t\t{\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tappendTo(element)\r\n\t\t{\r\n\t\t\telement.appendChild(this.domElement);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\taddControllers(controllers)\r\n\t\t{\r\n\t\t\tfor(let con of controllers) this.addController(con);\r\n\t\t},\r\n\t\taddController(controller)\r\n\t\t{\r\n\t\t\tthis.controllers.add(controller);\r\n\t\t\tcontroller.addEventListener(\"controllerChange\",this,this.propagateControllerChange)\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tpropagateControllerChange(event)\r\n\t\t{\r\n\t\t\tif(!this.pause&&this.game!=null)\r\n\t\t\t{\r\n\t\t\t\tthis.game.onControllerChange(event);\r\n\t\t\t}\r\n\t\t},\r\n\t\tremoveControllers(controllers)\r\n\t\t{\r\n\t\t\tfor(let con of controllers) this.removeController(con);\r\n\t\t},\r\n\t\tremoveController(controller)\r\n\t\t{\r\n\t\t\tthis.controllers.delete(controller);\r\n\t\t\tcontroller.removeEventListener(\"controllerChange\",this);\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tsetGame(game)\r\n\t\t{\r\n\t\t\tif(this.game!=null)\r\n\t\t\t{\r\n\t\t\t\tthis.game.system=null;\r\n\t\t\t\tthis.game.setPause(true);\r\n\t\t\t\tthis.domElement.removeChild(this.game.domElement);\r\n\t\t\t}\r\n\t\t\tthis.game=game;\r\n\t\t\tif(this.game!=null)\r\n\t\t\t{\r\n\t\t\t\tif(this.game.system!=null)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.game.system.setGame(null);\r\n\t\t\t\t}\r\n\t\t\t\tthis.game.system=this;\r\n\t\t\t\tthis.game.setPause(this.pause);\r\n\t\t\t\tthis.domElement.appendChild(this.game.domElement);\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync save(oldSave)\r\n\t\t{\r\n\t\t\tif(this.memoryCard==null) throw new ReferenceError(\"#Game:001 no memory card\");\r\n\r\n\t\t\tlet param={state:this.program.state};\r\n\t\t\tif(oldSave!=null)\r\n\t\t\t{\r\n\t\t\t\tparam.oldSaves=[oldSave,...(oldSave.oldSaves.slice(0,this.OLD_SAVE_COUNT-1))];\r\n\t\t\t}\r\n\t\t\treturn this.memoryCard.save(this.program.name,new SC.GameSave(param));\r\n\t\t}\r\n\t});\r\n\r\n\tSMOD(\"gs.System\",gs.System);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet gs=µ.gs=µ.gs||{};\r\n\r\n\t//SC=SC({});\r\n\r\n\tgs.MemoryCard=µ.Class({\r\n\t\t[µ.Class.symbols.abstract]:true,\r\n\t\t[µ.Class.symbols.onExtend]:function(sub)\r\n\t\t{\r\n\t\t\tif(typeof sub.prototype.save!=\"function\") throw new SyntaxError(\"#MemoryCard:001 no save function defined\");\r\n\t\t\tif(typeof sub.prototype.getAll!=\"function\") throw new SyntaxError(\"#MemoryCard:001 no getAll function defined\");\r\n\t\t},\r\n\t\t//async save(gameName,gameSave){},\r\n\t\t//async getAll(gameName){}\r\n\t});\r\n\r\n\tSMOD(\"gs.MemoryCard\",gs.MemoryCard);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet MemoryCard=GMOD(\"gs.MemoryCard\");\r\n\r\n\tSC=SC({\r\n\t\tObjectConnector:\"ObjectConnector\",\r\n\t\tGameSave:\"gs.GameSave\"\r\n\t});\r\n\r\n\tMemoryCard.Connector=µ.Class(MemoryCard,{\r\n\t\t[µ.Class.symbols.abstract]:true,\r\n\t\t[µ.Class.symbols.onExtend]:function(sub)\r\n\t\t{\r\n\t\t\tif(typeof sub.prototype.getConnector!=\"function\") throw new SyntaxError(\"#MemoryCard.Connector:001 no getConnector function defined\");\r\n\t\t},\r\n\t\t//getConnector(name){},\r\n\t\tsave(gameName,gameSave)\r\n\t\t{\r\n\t\t\tlet connector=this.getConnector(gameName);\r\n\t\t\treturn connector.save(gameSave);\r\n\t\t},\r\n\t\tgetAll(gameName)\r\n\t\t{\r\n\t\t\tlet connector=this.getConnector(gameName);\r\n\t\t\treturn connector.load(SC.GameSave);\r\n\t\t}\r\n\t});\r\n\r\n\tSMOD(\"gs.MemCon\",MemoryCard.Connector);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet MemCon=GMOD(\"gs.MemCon\");\r\n\r\n\tSC=SC({\r\n\t\tObjectConnector:\"ObjectConnector\"\r\n\t});\r\n\r\n\tMemCon.Object=µ.Class(MemCon,{\r\n\t\tconstructor:function(global=false)\r\n\t\t{\r\n\t\t\tthis.connectors=new Map();\r\n\t\t\tthis.global=global;\r\n\t\t},\r\n\t\tgetConnector(name)\r\n\t\t{\r\n\t\t\tif(!this.connectors.has(name))\r\n\t\t\t{\r\n\t\t\t\tthis.connectors.set(name,new SC.ObjectConnector(this.global));\r\n\t\t\t}\r\n\t\t\treturn this.connectors.get(name);\r\n\t\t}\r\n\t});\r\n\r\n\tSMOD(\"gs.MemCon.Object\",MemCon.Object);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet gs=µ.gs=µ.gs||{};\r\n\r\n\tlet DBObj=GMOD(\"DBObj\");\r\n\r\n\t//SC=SC({});\r\n\r\n\tgs.GameSave=µ.Class(DBObj,{\r\n\t\tobjectType:\"GameSave\",\r\n\t\tconstructor:function(param={})\r\n\t\t{\r\n\t\t\tthis.mega(param);\r\n\r\n\t\t\tlet {\r\n\t\t\t\tdate=new Date(),\r\n\t\t\t\toldSaves=[],\r\n\t\t\t\tstate=null\r\n\t\t\t}=param;\r\n\r\n\t\t\tif(oldSaves.length>gs.GameSave.OLD_SAVE_COUNT)\r\n\t\t\t{\r\n\t\t\t\toldSaves.length=gs.GameSave.OLD_SAVE_COUNT;\r\n\t\t\t}\r\n\r\n\t\t\tthis.addField(\"date\",\t\tFIELD.TYPES.DATE\t,date );\r\n\t\t\tthis.addField(\"state\",\t\tFIELD.TYPES.JSON\t,state);\r\n\t\t\tthis.addField(\"oldSaves\",\tFIELD.TYPES.JSON\t,oldSaves);\r\n\t\t}\r\n\t});\r\n\tgs.GameSave.OLD_SAVE_COUNT=3;\r\n\r\n\tSMOD(\"gs.GameSave\",gs.GameSave);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet gs=µ.gs=µ.gs||{};\r\n\r\n\t//SC=SC({});\r\n\r\n\tlet gameNames=new Map();\r\n\r\n\tgs.Game=µ.Class({\r\n\t\t[µ.Class.symbols.abstract]:true,\r\n\t\t[µ.Class.symbols.onExtend]:function(sub)\r\n\t\t{\r\n\t\t\tlet sProt=sub.prototype;\r\n\t\t\tif(!sProt.hasOwnProperty(\"name\")||!sProt.name) throw new SyntaxError(\"#Game:001 Game has no name\");\r\n\t\t\tif(gameNames.has(sProt.name)) throw new RangeError(\"#Game:002 Game name must be unique\");\r\n\t\t\tgameNames.set(sProt.name,sub);\r\n\t\t},\r\n\t\tconstructor:function({elementTag=\"DIV\",domElement=document.createElement(elementTag)}={})\r\n\t\t{\r\n\t\t\tthis.state=null;\r\n\t\t\tthis.system=null; // set from System.setProgramm()\r\n\t\t\tthis.domElement=domElement;\r\n\t\t\tthis.domElement.classList.add(\"Game\");\r\n\t\t\tthis.domElement.classList.add(this.name);\r\n\r\n\t\t\tthis.pause=true;\r\n\t\t},\r\n\t\tsetPause(value)\r\n\t\t{\r\n\t\t\tthis.pause=!!value;\r\n\t\t},\r\n\t\tonControllerChange(event){},\r\n\t\tasync save(oldSave=null)\r\n\t\t{\r\n\t\t\tif(this.system!=null)\r\n\t\t\t{\r\n\t\t\t\treturn this.system.save(oldSave);\r\n\t\t\t}\r\n\t\t\tthrow new ReferenceError(\"#Game:003 System is null\");\r\n\t\t},\r\n\t\tasync getSaves()\r\n\t\t{\r\n\t\t\tif(this.system!=null)\r\n\t\t\t{\r\n\t\t\t\treturn this.system.getSaves(this.name);\r\n\t\t\t}\r\n\t\t\treturn [];\r\n\t\t},\r\n\t\tdestroy()\r\n\t\t{\r\n\t\t\tthis.domElement.remove();\r\n\t\t\tthis.mega();\r\n\t\t}\r\n\t});\r\n\r\n\tgs.Game.getGameByName=function(name)\r\n\t{\r\n\t\treturn gameNames.get(name);\r\n\t};\r\n\r\n\tSMOD(\"gs.Game\",gs.Game);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet Game=GMOD(\"gs.Game\");\r\n\r\n\tSC=SC({\r\n\t\trs:\"rescope\"\r\n\t});\r\n\r\n\t/**\r\n\t * Game Class to execute an gs.Game.Embedded using an iframe\r\n\t */\r\n\tGame.Remote=µ.Class(Game,{\r\n\t\t[µ.Class.symbols.abstract]:function(name,url)\r\n\t\t{\r\n\t\t\treturn {name:name,url:new URL(url,location.href)};\r\n\t\t},\r\n\t\t[µ.Class.symbols.onExtend]:function(sub)\r\n\t\t{\r\n\t\t\tGame.prototype[µ.Class.symbols.onExtend](sub);\r\n\t\t\tlet sProt=sub.prototype;\r\n\t\t\tif(!sProt.url) throw new SyntaxError(\"#Game.Remote:001 Game has no url\");\r\n\t\t\tif(!(sProt.url instanceof URL)) throw new SyntaxError(\"#Game.Remote:002 Game url is not an instance of URL\");\r\n\t\t},\r\n\t\tconstructor:function()\r\n\t\t{\r\n\t\t\tSC.rs.all(this,[\"_onLoad\",\"_onMessage\"]);\r\n\t\t\tthis.mega({elementTag:\"IFRAME\"});\r\n\t\t\tthis.domElement.classList.add(\"Remote\")\r\n\t\t\tthis.domElement.sandbox=\"allow-orientation-lock allow-pointer-lock allow-scripts allow-same-origin\";\r\n\t\t\tthis.domElement.src=this.url;\r\n\t\t\tthis.domElement.addEventListener(\"load\",this._onLoad,false);\r\n\t\t\tthis.domElement.addEventListener(\"message\",this._onMessage,false);\r\n\t\t},\r\n\t\t_onLoad()\r\n\t\t{\r\n\t\t\tthis.setPause(this.pause);\r\n\t\t},\r\n\t\t_onMessage(event)\r\n\t\t{\r\n\t\t\tif(event.origin===this.url.origin)\r\n\t\t\t{\r\n\t\t\t\tlet message=event.data;\r\n\t\t\t\tlet promise=null;\r\n\t\t\t\tswitch(message.type)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"save\":\r\n\t\t\t\t\t\tthis.state=message.state;\r\n\t\t\t\t\t\tpromise=this.save(message.oldSave)\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"getSaves\":\r\n\t\t\t\t\t\tpromise=this.getSaves(message.oldSave);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif(promise)\r\n\t\t\t\t{\r\n\t\t\t\t\tpromise.then(data=>({data:data}),error=>({error:error}))\r\n\t\t\t\t\t.then(answer=>\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tanswer.request=message.request;\r\n\t\t\t\t\t\tthis._send(answer);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\t_send(message)\r\n\t\t{\r\n\t\t\tif(this.domElement.contentWindow)\r\n\t\t\t{\r\n\t\t\t\tthis.domElement.contentWindow.postMessage(message,this.url.origin);\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetPause(value)\r\n\t\t{\r\n\t\t\tthis.pause=!!value;\r\n\t\t\tthis._send({\r\n\t\t\t\ttype:\"pause\",\r\n\t\t\t\tvalue:this.pause\r\n\t\t\t});\r\n\t\t},\r\n\t\tonControllerChange(event)\r\n\t\t{\r\n\t\t\tthis._send({\r\n\t\t\t\ttype:\"controllerEvent\",\r\n\t\t\t\tevent:event\r\n\t\t\t});\r\n\t\t}\r\n\t});\r\n\r\n\tSMOD(\"gs.Game.Remote\",Game.Remote);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet Game=GMOD(\"gs.Game\");\r\n\r\n\tSC=SC({\r\n\t\trs:\"rescope\",\r\n\t\tPromise:\"Promise\"\r\n\t});\r\n\r\n\tlet REQUEST_COUNTER=0;\r\n\r\n\tGame.Embedded=µ.Class(Game,{\r\n\t\t[µ.Class.symbols.abstract]:true,\r\n\t\tconstructor:function(param={})\r\n\t\t{\r\n\t\t\tSC.rs.all(this,[\"_onMessage\"]);\r\n\r\n\t\t\tparam.domElement=document.body;\r\n\r\n\t\t\tthis.mega(param);\r\n\t\t\tthis.domElement.classList.add(\"Embedded\");\r\n\r\n\t\t\t({\r\n\t\t\t\ttimeout:this.timeout=50000\r\n\t\t\t}=param);\r\n\r\n\t\t\tthis.requestMap=new Map();\r\n\t\t},\r\n\t\t_send(message)\r\n\t\t{\r\n\t\t\twindow.parent.postMessage(message,window.parent.origin);\r\n\t\t},\r\n\t\t_request(message)\r\n\t\t{\r\n\t\t\tmessage.request=REQUEST_COUNTER++;\r\n\r\n\t\t\tlet timer;\r\n\t\t\tlet promise=new SC.Promise(()=>\r\n\t\t\t{\r\n\t\t\t\tthis.requestMap.set(message.request,signal);\r\n\t\t\t\ttimer=setTimeout(()=>\r\n\t\t\t\t{\r\n\t\t\t\t\tsignal.reject(\"timeout\");\r\n\t\t\t\t},this.timeout);\r\n\t\t\t},{scope:this});\r\n\t\t\tpromise.always(()=>\r\n\t\t\t{\r\n\t\t\t\tthis.requestMap.delete(message.request);\r\n\t\t\t\tclearTimeout(timer);\r\n\t\t\t});\r\n\t\t},\r\n\t\t_onMessage(event)\r\n\t\t{\r\n\t\t\tlet message=event.data;\r\n\t\t\tif(\"request\" in message)\r\n\t\t\t{\r\n\t\t\t\tif(!this.requestMap.has(message.request))\r\n\t\t\t\t{\r\n\t\t\t\t\tµ.logger.error(\"#Game.Embedded:001 no such request \"+message.request);\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tlet signal=this.requestMap.get(event.data.request);\r\n\r\n\t\t\t\t\tif(message.error) signal.reject(error);\r\n\t\t\t\t\telse signal.resolve(message.data);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tsave(oldSave)\r\n\t\t{\r\n\t\t\treturn this._request({type:\"save\",oldSave:oldSave,state:this.state});\r\n\t\t},\r\n\t\tgetSaves()\r\n\t\t{\r\n\t\t\treturn this._request({type:\"getSaves\"});\r\n\t\t}\r\n\t});\r\n\r\n\tSMOD(\"gs.Game.Embedded\",Game.Embedded);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n    let gs=µ.gs=µ.gs||{};\r\n\r\n\tSC=SC({\r\n\t\tAxis:\"gs.Axis\"\r\n\t});\r\n\r\n\tgs.Stick=µ.Class({\r\n\t\tconstructor:function(xAxis=new SC.Axis(),yAxis=new SC.Axis())\r\n\t\t{\r\n\t\t\tthis.xAxis=xAxis;\r\n\t\t\tthis.yAxis=yAxis;\r\n\t\t},\r\n\t\tsetValue(valueX,valueY)\r\n\t\t{\r\n\t\t\tlet rtn=this.xAxis.setValue(valueX);\r\n\t\t\trtn|=this.yAxis.setValue(valueY);\r\n\t\t\treturn rtn;\r\n\t\t},\r\n\t\tgetState()\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tx:this.xAxis.value,\r\n\t\t\t\ty:this.yAxis.value\r\n\t\t\t};\r\n\t\t},\r\n\t\ttoJSON()\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\txAxis:this.xAxis,\r\n\t\t\t\tyAxis:this.yAxis\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\tgs.Stick.fromJSON=function(json)\r\n\t{\r\n\t\treturn new gs.Stick({\r\n\t\t\txAxis:new SC.Acis(json.xAxis),\r\n\t\t\tyAxis:new SC.Acis(json.yAxis)\r\n\t\t});\r\n\t};\r\n\r\n\tSMOD(\"gs.Stick\",gs.Stick);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet gs=µ.gs=µ.gs||{};\r\n\r\n\tlet Event=GMOD(\"Event\");\r\n\r\n\tSC=SC({\r\n\t\tremove:\"array.remove\",\r\n\t\tremoveIf:\"array.removeIf\",\r\n\t\tReporter:\"EventReporterPatch\",\r\n\r\n\t\tButton:\"gs.Button\",\r\n\t\tAxis:\"gs.Axis\",\r\n\t\tStick:\"gs.Stick\"\r\n\t});\r\n\r\n\tgs.Controller=µ.Class({\r\n\t\tconstructor:function({buttons=[],axes=[],sticks=[]}={})\r\n\t\t{\r\n\t\t\tthis.buttons=[];\r\n\t\t\tthis.axes=[];\r\n\t\t\tthis.sticks=[];\r\n\r\n\t\t\tthis.addButtons(buttons);\r\n\t\t\tthis.addAxes(axes);\r\n\t\t\tthis.addSticks(sticks);\r\n\r\n\t\t\tnew SC.Reporter(this)\r\n\t\t\t.introduce(gs.Controller.ChangeEvent);\r\n\r\n\t\t},\r\n\t\taddButtons(buttons)\r\n\t\t{\r\n\t\t\tthis.buttons.push(...buttons);\r\n\t\t},\r\n\t\tremoveButtons(buttons)\r\n\t\t{\r\n\t\t\tSC.removeIf(this.buttons,buttons.includes,true,buttons)\r\n\t\t},\r\n\t\tremoveButton(button)\r\n\t\t{\r\n\t\t\tSC.remove(this.buttons,button);\r\n\t\t},\r\n\t\taddAxes(axes)\r\n\t\t{\r\n\t\t\tthis.axes.push(...axes);\r\n\t\t},\r\n\t\tremoveAxes(axes)\r\n\t\t{\r\n\t\t\tSC.removeIf(this.axes,axes.includes,true,axes)\r\n\t\t},\r\n\t\tremoveAxe(axe)\r\n\t\t{\r\n\t\t\tSC.remove(this.axes,axe);\r\n\t\t},\r\n\t\taddSticks(sticks)\r\n\t\t{\r\n\t\t\tthis.sticks.push(...sticks);\r\n\t\t},\r\n\t\tremoveSticks(sticks)\r\n\t\t{\r\n\t\t\tSC.removeIf(this.sticks,sticks.includes,true,sticks)\r\n\t\t},\r\n\t\tremoveStick(stick)\r\n\t\t{\r\n\t\t\tSC.remove(this.sticks,stick);\r\n\t\t},\r\n\t\tgetState()\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tbuttons:this.buttons.map(b=>b.getState()),\r\n\t\t\t\taxes:this.axes.map(a=>a.getState()),\r\n\t\t\t\tsticks:this.sticks.map(s=>s.getState()),\r\n\t\t\t};\r\n\t\t},\r\n\t\tsetButton:function(index,value)\r\n\t\t{\r\n\t\t\tif(index<0||index>=this.buttons.length)\r\n\t\t\t{\r\n\t\t\t\tµ.logger.error(`#gs.Controller:001 index out of bounds (Button ${index})`);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet button=this.buttons[index];\r\n\t\t\tif(button.setValue(value))\r\n\t\t\t{\r\n\t\t\t\tthis.reportEvent(new gs.Controller.ChangeEvent(this,\"button\",index,button.getState()));\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetAxis:function(index,value)\r\n\t\t{\r\n\t\t\tif(index<0||index>=this.axes.length)\r\n\t\t\t{\r\n\t\t\t\tµ.logger.error(`#gs.Controller:002 index out of bounds (Axis ${index})`);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet axis=this.axes[index];\r\n\t\t\tif(axis.setValue(value))\r\n\t\t\t{\r\n\t\t\t\tthis.reportEvent(new gs.Controller.ChangeEvent(this,\"axis\",index,axis.getState()));\r\n\t\t\t}\r\n\t\t},\r\n\t\tsetStick:function(index,valueX,valueY)\r\n\t\t{\r\n\t\t\tif(index<0||index>=this.sticks.length)\r\n\t\t\t{\r\n\t\t\t\tµ.logger.error(`#gs.Controller:003 index out of bounds (stick ${index})`);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet stick=this.sticks[index];\r\n\t\t\tif(stick.setValue(valueX,valueY))\r\n\t\t\t{\r\n\t\t\t\tthis.reportEvent(new gs.Controller.ChangeEvent(this,\"stick\",index,stick.getState()));\r\n\t\t\t}\r\n\t\t},\r\n\t\ttoJSON()\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tbuttons:this.buttons,\r\n\t\t\t\taxes:this.axes,\r\n\t\t\t\tsticks:this.sticks\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\tgs.Controller.fromJSON=function(json)\r\n\t{\r\n\t\tif(json.buttons) json.buttons=buttons.map(SC.Button.fromJSON);\r\n\t\tif(json.axes) json.axes=json.axes.map(SC.Axis.fromJSON);\r\n\t\tif(json.sticks) json.sticks=json.sticks.map(SC.Sticks.fromJSON);\r\n\r\n\t\treturn new gs.Controller(buttons,axes,sticks);\r\n\t};\r\n\r\n\tSMOD(\"gs.Controller\",gs.Controller);\r\n\r\n\tgs.Controller.ChangeEvent=µ.Class(Event,\r\n\t{\r\n\t\tname:\"controllerChange\",\r\n\t\tconstructor:function(controller,type,index,value)\r\n\t\t{\r\n\t\t\t/** @type {gs.Controller} */\r\n\t\t\tthis.controller=controller\r\n\t\t\t/** @type {String} \"button\", \"axis\" or \"stick\" */\r\n\t\t\tthis.type=type;\r\n\t\t\t/** @type {Number} */\r\n\t\t\tthis.index=index;\r\n\t\t\t/** @type {gs.Button|gs.Axes|gs.Stick} */\r\n\t\t\tthis.value=value;\r\n\t\t}\r\n\t});\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet Controller=GMOD(\"gs.Controller\");\r\n\r\n\tSC=SC({\r\n\t\tButton:\"gs.Button\",\r\n\t\tAxis:\"gs.Axis\",\r\n\t\tStick:\"gs.Stick\"\r\n\t});\r\n\r\n\tController.Keyboard=µ.Class(Controller,{\r\n\t\t/**\r\n\t\t * @typedef {Object} Controller.Keyboard~mappings\r\n\t\t * @param {Object.<String,Number>} (param.buttons)\r\n\t\t * @param {Object.<String,{index:Number,negative:Boolean}}>} (param.axes)\r\n\t\t * @param {Object.<String,{index:Number,axis:String,negative:Boolean}>} (param.sticks)\r\n\t\t */\r\n\t\t /**\r\n\t\t  * @param {Object} param\r\n\t\t  * @param {Controller.Keyboard~mappings} param.mappings\r\n\t\t  * @param {Boolean} (generateButtons) defaults to true if no Button is defined\r\n\t\t  * @param {Boolean} (generateAxes) defaults to true if no Axis is defined\r\n\t\t  * @param {Boolean} (generateSticks) defaults to true if no Stick is defined\r\n\t\t  */\r\n\t\tconstructor:function(param={})\r\n\t\t{\r\n\t\t\tthis.mega(param);\r\n\r\n\t\t\tthis.mapping=new Map();\r\n\r\n\r\n\t\t\tif(param.mappings) this.associate(param.mappings);\r\n\r\n\t\t\tlet {\r\n\t\t\t\tgenerateButtons=this.buttons.length==0,\r\n\t\t\t\tgenerateAxes=this.axes.length==0,\r\n\t\t\t\tgenerateSticks=this.sticks.length==0\r\n\t\t\t}=param;\r\n\r\n\t\t\tif(generateButtons) this.generateButtons();\r\n\t\t\tif(generateAxes) this.generateAxes();\r\n\t\t\tif(generateSticks) this.generateSticks();\r\n\r\n\t\t},\r\n\t\tassociate({buttons={},axes={},sticks={}})\r\n\t\t{\r\n\t\t\tfor(let key in buttons)\r\n\t\t\t{\r\n\t\t\t\tthis.associateButton(key,buttons[key]);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let key in axes)\r\n\t\t\t{\r\n\t\t\t\tlet settings=axes[key];\r\n\t\t\t\tthis.associateAxis(key,settings.index,settings.negative);\r\n\t\t\t}\r\n\r\n\t\t\tfor(let key in sticks)\r\n\t\t\t{\r\n\t\t\t\tlet settings=sticks[key];\r\n\t\t\t\tthis.associateStick(key,settings.index,settings.axis,settings.negative);\r\n\t\t\t}\r\n\t\t},\r\n\t\tassociateButton(key,index)\r\n\t\t{\r\n\t\t\tif(index in this.buttons)\r\n\t\t\t{\r\n\t\t\t\tthis.buttons[index]=new SC.Button();\r\n\t\t\t}\r\n\t\t\tthis.mapping.set(key,{\r\n\t\t\t\ttype:\"button\",\r\n\t\t\t\tindex:index\r\n\t\t\t});\r\n\t\t},\r\n\t\tassociateAxis(key,index,negative)\r\n\t\t{\r\n\t\t\tif(index in this.axes)\r\n\t\t\t{\r\n\t\t\t\tthis.axes[index]=new SC.Axis();\r\n\t\t\t}\r\n\t\t\tthis.mapping.set(key,{\r\n\t\t\t\ttype:\"axis\",\r\n\t\t\t\tindex:index,\r\n\t\t\t\tnegative:negative\r\n\t\t\t});\r\n\t\t},\r\n\t\t/**\r\n\t\t * @param {String} key\r\n\t\t * @param {Number} index\r\n\t\t * @param {String} axis - \"x\" or \"y\"\r\n\t\t * @param {boolean} (negative)\r\n\t\t */\r\n\t\tassociateStick(key,index,axis,negative)\r\n\t\t{\r\n\t\t\tif(index in this.sticks)\r\n\t\t\t{\r\n\t\t\t\tthis.sticks[index]=new SC.Stick();\r\n\t\t\t}\r\n\t\t\tthis.mapping.set(key,{\r\n\t\t\t\ttype:\"stick\",\r\n\t\t\t\taxis:axis,\r\n\t\t\t\tindex:index,\r\n\t\t\t\tnegative:negative\r\n\t\t\t});\r\n\t\t},\r\n\t\tgenerateButtons()\r\n\t\t{\r\n\t\t\tfor(let value of this.mapping.values())\r\n\t\t\t{\r\n\t\t\t\tif(value.type==\"button\"&&this.buttons[value.index]==null)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.buttons[value.index]=new SC.Button();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n        generateAxes()\r\n        {\r\n        \tfor(let value of this.mapping.values())\r\n        \t{\r\n        \t\tif(value.type==\"axis\"&&this.axes[value.index]==null)\r\n        \t\t{\r\n        \t\t\tthis.axes[value.index]=new SC.Axis();\r\n        \t\t}\r\n        \t}\r\n        },\r\n        generateSticks()\r\n        {\r\n        \tfor(let value of this.mapping.values())\r\n        \t{\r\n        \t\tif(value.type==\"stick\"&&this.sticks[value.index]==null)\r\n        \t\t{\r\n        \t\t\tthis.sticks[value.index]=new SC.Stick();\r\n        \t\t}\r\n        \t}\r\n        },\r\n        /**\r\n         * @param {Event} event\r\n         * @returns {Boolean} event consumed\r\n         */\r\n\t\tparseEvent:function(event)\r\n\t\t{\r\n\t\t\tlet mapping=this.mapping.get(event.code);\r\n\t\t\tif(mapping)\r\n\t\t\t{\r\n\t\t\t\tlet value=(event.type==\"keydown\"?100:0);\r\n\t\t\t\tswitch (mapping.type)\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"button\":\r\n\t\t\t\t\t\treturn this.setButton(mapping.index,value);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"axis\":\r\n\t\t\t\t\t\tif(mapping.negative) value=-value;\r\n\t\t\t\t\t\treturn this.setAxis(mapping.index,value);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"stick\":\r\n\t\t\t\t\t\tif(mapping.negative) value=-value;\r\n\t\t\t\t\t\tlet valueX=null;\r\n\t\t\t\t\t\tlet valueY=null;\r\n\t\t\t\t\t\tif(mapping.axis===\"x\") valueX=value;\r\n\t\t\t\t\t\telse valueY=value;\r\n\t\t\t\t\t\treturn this.setStick(mapping.index,valueX,valueY);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\ttoJSON()\r\n\t\t{\r\n\t\t\tlet json=this.mega();\r\n\t\t\tjson.mappings=[...this.mappings.entries()];\r\n\t\t}\r\n\t});\r\n\r\n\tController.Keyboard.fromJSON=function(json)\r\n\t{\r\n\t\tif(json.buttons) json.buttons=buttons.map(SC.Button.fromJSON);\r\n\t\tif(json.axes) json.axes=json.axes.map(SC.Axis.fromJSON);\r\n\t\tif(json.sticks) json.sticks=json.sticks.map(SC.Sticks.fromJSON);\r\n\r\n\t\tlet rtn=new Controller.Keyboard(json);\r\n\r\n\t\treturn rtn;\r\n\t};\r\n\r\n\tSMOD(\"gs.Controller.Keyboard\",Controller.Keyboard);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet gs=µ.gs=µ.gs||{};\r\n\r\n\t//SC=SC({});\r\n\r\n\t/** @typedef {Object} controllerMapping\r\n\t * @property {Object.<Number,String>} (button)\r\n\t * @property {Object.<Number,String>} (axis)\r\n\t * @property {Object.<Number,String>} (stick)\r\n\t */\r\n\r\n\tgs.Component=µ.Class({\r\n\t\t[µ.Class.symbols.abstract]:true,\r\n\t\tconstructor:function(controllerMapping=new Map())\r\n\t\t{\r\n\t\t\t/** @type {Map.<Controller,controllerMapping>} */\r\n\t\t\tthis.controllerMapping=controllerMapping;\r\n\t\t\t/** @type {WeakMap.<Controller,Set<Number>>} */\r\n\t\t\tthis.pressedButtons=new WeakMap();\r\n\t\t},\r\n\t\taddControllerMapping(controller,type,index,action)\r\n\t\t{\r\n\t\t\tif(!this.controllerMapping.has(controller))\r\n\t\t\t{\r\n\t\t\t\tthis.controllerMapping.set(controller,{});\r\n\t\t\t}\r\n\t\t\tlet mapping=this.controllerMapping.get(controller);\r\n\t\t\tif(!mapping[type]) mapping[type]={};\r\n\t\t\tmapping[type][index]=action;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\t/** @type {Object.<String,Function>} */\r\n\t\tactions:{},\r\n\t\t/**\r\n\t\t * @param {gs.Controller.ChangeEvent} event\r\n\t\t * @returns {boolean} consumed\r\n\t\t */\r\n\t\tconsumeControllerChange(event)\r\n\t\t{\r\n\t\t\tlet mapping=this.controllerMapping.get(event.controller);\r\n\t\t\tif(!mapping)\r\n\t\t\t{\r\n\t\t\t\tmapping=this.mappings.get(null);\r\n\t\t\t}\r\n\t\t\tif(mapping&&mapping[event.type])\r\n\t\t\t{\r\n\t\t\t\tlet typeMapping=mapping[event.type];\r\n\t\t\t\tlet indexMapping=typeMapping[event.index]||typeMapping[null];\r\n\t\t\t\tif(indexMapping&&indexMapping in this.actions)\r\n\t\t\t\t{\r\n\t\t\t\t\tlet action=this.actions[indexMapping];\r\n\t\t\t\t\taction.call(this,event.value,event);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t},\r\n\t\t/**\r\n\t\t * keeps track of pressed buttons and returns true if a button was pressed now\r\n\t\t * @protected\r\n\t\t * @param {gs.Controller.ChangeEvent} event\r\n\t\t * @returns {Boolean} button pressed now\r\n\t\t */\r\n\t\t_acceptButton(event)\r\n\t\t{\r\n\t\t\tif(!button.pressed)\r\n\t\t\t{\r\n\t\t\t\tthis.pressedButtons.delete(event.index);\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\telse if(!this.pressedButtons.has(event.index))\r\n\t\t\t{\r\n\t\t\t\tthis.pressedButtons.add(event.index);\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\tSMOD(\"gs.Component\",gs.Component);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n\tlet Component=GMOD(\"gs.Component\");\r\n\r\n\tSC=SC({\r\n\t\trs:\"rescope\"\r\n\t});\r\n\r\n\tComponent.List=µ.Class(Component,{\r\n\t\tconstructor:function(data=[],mapper=Component.STD_MAPPER,{columns=1,active=0,controllerMapping=Component.STD_CONTROLLER_MAPPING}={})\r\n\t\t{\r\n\t\t\tSC.rs.all(this,[\"_step\",\"moveRight\",\"moveLeft\",\"moveDown\",\"moveUp\"]);\r\n\r\n\t\t\tthis.mega(controllerMapping);\r\n\r\n\t\t\tthis.columns=1;\r\n\t\t\tthis.data=data;\r\n\t\t\tthis.mapper=mapper;\r\n\r\n\t\t\tthis.active=active;\r\n\r\n\t\t\tthis.domElement=document.createElement(\"DIV\");\r\n\t\t\tthis.domElement.classList.add(\"Component\",\"List\");\r\n\r\n\t\t\tthis.setColumns(columns);\r\n\r\n\t\t\tthis.movement={\r\n\t\t\t\tmethod:null,\r\n\t\t\t\ttimer:null,\r\n\t\t\t\tcurrentTime:Component.INITIAL_MOVEMENT_TIMEOUT\r\n\t\t\t}\r\n\r\n\t\t\tthis.update();\r\n\t\t},\r\n\t\tupdate()\r\n\t\t{\r\n\t\t\twhile(this.domElement.firstChild) this.domElement.removeChild(this.domElement.firstChild);\r\n\r\n\t\t\tthis.active=Math.min(Math.max(this.active,0),this.data.length);\r\n\r\n\t\t\tfor(let index=0;index<this.data.length;index++)\r\n\t\t\t{\r\n\t\t\t\tlet element=document.createElement(\"DIV\");\r\n\t\t\t\tthis.mapper(element,this.data[index]);\r\n\t\t\t\telement.dataset.index=index;\r\n\t\t\t\tif(this.active===index) element.classList.add(\"active\");\r\n\t\t\t\tthis.domElement.appendChild(element);\r\n\t\t\t}\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tsetData(data=[])\r\n\t\t{\r\n\t\t\tthis.data=data;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tsetMapper(mapper=Component.STD_MAPPER)\r\n\t\t{\r\n\t\t\tthis.mapper=mapper;\r\n\t\t\treturn this;\r\n\t\t},\r\n\t\tsetColumns(columns)\r\n\t\t{\r\n\t\t\tthis.columns=Math.max(columns,1);\r\n\t\t\tthis.domElement.style.setProperty(\"--list-columns\",this.columns);\r\n\t\t},\r\n\t\tactions:{\r\n\t\t\tmove(stick)\r\n\t\t\t{\r\n\t\t\t\tlet absX=Math.abs(stick.x);\r\n\t\t\t\tlet absY=Math.abs(stick.y);\r\n\t\t\t\tif(absX<33&&absY<33)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis._stopMovement();\r\n\t\t\t\t}\r\n\t\t\t\telse if(absX>=absY)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.movement.method=stick.x<0?this.moveLeft:this.moveRight;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.movement.method=stick.y<0?this.moveUp:this.moveDown;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._step();\r\n\t\t\t}\r\n\t\t},\r\n\t\t_stopMovement()\r\n\t\t{\r\n\t\t\tclearTimeout(this.movement.timer);\r\n\t\t\tthis.movement.method=null;\r\n\t\t\tthis.movement.currentTime=Component.INITIAL_MOVEMENT_TIMEOUT;\r\n\t\t},\r\n\t\tmoveRight()\r\n\t\t{\r\n\t\t\tthis.domElement.children[this.active].classList.remove(\"active\");\r\n\r\n\t\t\tthis.active=(this.active+1)%this.data.length;\r\n\r\n\t\t\tthis.domElement.children[this.active].classList.add(\"active\");\r\n\t\t},\r\n\t\tmoveLeft()\r\n\t\t{\r\n\t\t\tthis.domElement.children[this.active].classList.remove(\"active\");\r\n\r\n\t\t\tif(this.active<0)this.active=this.data.length;\r\n\t\t\tthis.active--;\r\n\r\n\t\t\tthis.domElement.children[this.active].classList.add(\"active\");\r\n\t\t},\r\n\t\tmoveDown()\r\n\t\t{\r\n\t\t\tthis.domElement.children[this.active].classList.remove(\"active\");\r\n\r\n\t\t\tif(this.active+this.columns>=this.data.length) this.active=this.active%this.columns;\r\n\t\t\telse this.active+=this.columns;\r\n\r\n\t\t\tthis.domElement.children[this.active].classList.add(\"active\");\r\n\t\t},\r\n\t\tmoveUp()\r\n\t\t{\r\n\t\t\tthis.domElement.children[this.active].classList.remove(\"active\");\r\n\r\n\t\t\tif(this.active-this.columns<0) this.active=this.data.length-(this.data.length%this.columns-this.active);\r\n\t\t\telse this.active-=this.columns;\r\n\r\n\t\t\tthis.domElement.children[this.active].classList.add(\"active\");\r\n\t\t},\r\n\t\t_step()\r\n\t\t{\r\n\t\t\tthis.movement.method.call(this);\r\n\t\t\tthis.movement.timer=setTimeout(this._step,this.movement.currentTime);\r\n\t\t\tthis.movement.currentTime=Math.max(Component.MIN_MOVEMENT_TIMEOUT,this.movement.currentTime/Component.MOVEMENT_ACCELERATION);\r\n\t\t}\r\n\t});\r\n\r\n\tComponent.STD_MAPPER=(e,d)=>e.textContent=d;\r\n\tComponent.STD_CONTROLLER_MAPPING=new Map([[null,{\r\n\t\t\"stick\":{\r\n\t\t\t\"null\":\"move\"\r\n\t\t}\r\n\t}]]);\r\n\tComponent.INITIAL_MOVEMENT_TIMEOUT=1000;\r\n\tComponent.MIN_MOVEMENT_TIMEOUT=125;\r\n\tComponent.MOVEMENT_ACCELERATION=1.25;\r\n\r\n\tSMOD(\"gs.Component.List\",Component.List);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n    let gs=µ.gs=µ.gs||{};\r\n\r\n\t//SC=SC({});\r\n\r\n\tgs.Button=µ.Class({\r\n\t\tconstructor:function({value=0,threshold=50}={})\r\n\t\t{\r\n\t\t\tthis.value=0;\r\n\t\t\tthis.threshold=50;\r\n\r\n\t\t\tthis.setValue(value);\r\n\t\t\tthis.setThreshold(threshold);\r\n\t\t},\r\n\t\tsetThreshold(threshold=50)\r\n\t\t{\r\n\t\t\tthis.threshold=Math.min(Math.max(threshold,0),100);\r\n\t\t},\r\n        setValue(value=0)\r\n        {\r\n        \tif(value==null) return false;\r\n        \tvalue=Math.min(Math.max(value,0),100);\r\n        \tif(this.value==value) return false;\r\n        \tthis.value=value;\r\n        \treturn true;\r\n        },\r\n\t\tisPressed()\r\n\t\t{\r\n\t\t\treturn this.value>=this.threshold;\r\n\t\t},\r\n\t\tgetState()\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tvalue:this.value,\r\n\t\t\t\tpressed:this.isPressed()\r\n\t\t\t}\r\n\t\t},\r\n\t\ttoJSON()\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tthreshold:this.threshold\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\tgs.Button.fromJSON=function(json)\r\n\t{\r\n\t\treturn new gs.Button(json);\r\n\t};\r\n\r\n\tSMOD(\"gs.Button\",gs.Button);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);","(function(µ,SMOD,GMOD,HMOD,SC){\r\n\r\n    let gs=µ.gs=µ.gs||{};\r\n\r\n\t//SC=SC({});\r\n\r\n\tgs.Axis=µ.Class({\r\n\t\tconstructor:function({value=0,correction=0,scale=1}={})\r\n\t\t{\r\n\t\t\tthis.value=0;\r\n\t\t\tthis.correction=0;\r\n\t\t\tthis.scale=1;\r\n\r\n\t\t\tthis.setValue(value);\r\n\t\t\tthis.setCorrection(correction);\r\n\t\t\tthis.setScale(scale);\r\n\t\t},\r\n\t\tsetCorrection(correction=0)\r\n\t\t{\r\n\t\t\tthis.correction=Math.min(Math.max(correction,-100),100);\r\n\t\t},\r\n\t\tsetScale(scale=1)\r\n\t\t{\r\n\t\t\tthis.scale=Math.max(scale,Number.EPSILON);\r\n\t\t},\r\n        setValue(value)\r\n        {\r\n        \tif(value==null) return false;\r\n        \tvalue=Math.min(Math.max(value*this.scale+this.correction,-100),100);\r\n        \tif(this.value==value) return false;\r\n\t\t\tthis.value=value;\r\n\t\t\treturn true;\r\n        },\r\n\t\tgetState()\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tvalue:this.value\r\n\t\t\t};\r\n\t\t},\r\n\t\ttoJSON()\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tcorrection:this.correction,\r\n\t\t\t\tscale:this.scale\r\n\t\t\t};\r\n\t\t}\r\n\t});\r\n\r\n\tgs.Axis.fromJSON=function(json)\r\n\t{\r\n\t\treturn new gs.Axis(json);\r\n\t};\r\n\r\n\tSMOD(\"gs.Axis\",gs.Axis);\r\n\r\n})(Morgas,Morgas.setModule,Morgas.getModule,Morgas.hasModule,Morgas.shortcut);"]}